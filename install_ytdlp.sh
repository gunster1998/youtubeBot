#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ yt-dlp –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ yt-dlp –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
echo "=============================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã root
if [ "$EUID" -ne 0 ]; then
    echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –æ—Ç root"
    echo "–ó–∞–ø—É—Å—Ç–∏—Ç–µ: sudo ./install_ytdlp.sh"
    exit 1
fi

echo "‚úÖ –ó–∞–ø—É—â–µ–Ω–æ –æ—Ç root"

# –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã
echo "üì¶ –û–±–Ω–æ–≤–ª—è—é –ø–∞–∫–µ—Ç—ã..."
apt update

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º python3-pip –µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
if ! command -v pip3 &> /dev/null; then
    echo "üêç –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é python3-pip..."
    apt install -y python3-pip
else
    echo "‚úÖ python3-pip —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º yt-dlp —á–µ—Ä–µ–∑ pip
echo "üì• –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é yt-dlp —á–µ—Ä–µ–∑ pip..."
pip3 install --upgrade yt-dlp

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É
if command -v yt-dlp &> /dev/null; then
    echo "‚úÖ yt-dlp —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ"
    echo "üìä –í–µ—Ä—Å–∏—è: $(yt-dlp --version)"
    
    # –°–æ–∑–¥–∞–µ–º —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É –≤ /usr/local/bin –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    if [ ! -f /usr/local/bin/yt-dlp ]; then
        echo "üîó –°–æ–∑–¥–∞—é —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫—É—é —Å—Å—ã–ª–∫—É..."
        ln -sf $(which yt-dlp) /usr/local/bin/yt-dlp
    fi
    
    echo ""
    echo "üéâ yt-dlp –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"
    echo "üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞"
    
else
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ yt-dlp"
    exit 1
fi

echo ""
echo "üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
echo "============================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫
echo "üìÅ –ü—Ä–æ–≤–µ—Ä—è—é –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫..."
if [ ! -d "./downloads" ]; then
    echo "üî® –°–æ–∑–¥–∞—é –ø–∞–ø–∫—É downloads..."
    mkdir -p ./downloads
    chmod 755 ./downloads
fi

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:"
echo "go run cmd/bot/main.go"

