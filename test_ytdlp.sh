#!/bin/bash

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ yt-dlp –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

echo "üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ yt-dlp"
echo "======================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ yt-dlp
if ! command -v yt-dlp &> /dev/null; then
    echo "‚ùå yt-dlp –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: sudo apt install yt-dlp"
    exit 1
fi

echo "‚úÖ yt-dlp –Ω–∞–π–¥–µ–Ω: $(yt-dlp --version)"

# –¢–µ—Å—Ç–æ–≤—ã–π URL
TEST_URL="https://www.youtube.com/watch?v=dQw4w9WgXcQ"

echo ""
echo "üîç –¢–µ—Å—Ç–∏—Ä—É—é –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–ª—è: $TEST_URL"
echo "----------------------------------------"

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–æ—Ä–º–∞—Ç–æ–≤
yt-dlp --list-formats --no-playlist --no-check-certificates "$TEST_URL"

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úÖ –§–æ—Ä–º–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ"
    
    echo ""
    echo "üíæ –¢–µ—Å—Ç–∏—Ä—É—é —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥)..."
    echo "----------------------------------------"
    
    # –°–∫–∞—á–∏–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∞
    yt-dlp --format "best[ext=mp4]/best" \
           --output "test_video.%(ext)s" \
           --no-playlist \
           --no-check-certificates \
           --max-duration 10 \
           "$TEST_URL"
    
    if [ $? -eq 0 ]; then
        echo ""
        echo "‚úÖ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–ª—Å—è
        if [ -f test_video.* ]; then
            echo "üìÅ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª: $(ls test_video.*)"
            echo "üóëÔ∏è –£–¥–∞–ª—è—é —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª..."
            rm test_video.*
        fi
    else
        echo ""
        echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–æ–≤–æ–º —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏"
    fi
else
    echo ""
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤"
fi

echo ""
echo "üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:"
echo "=============================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é Python (yt-dlp –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Python)
echo "üêç Python –≤–µ—Ä—Å–∏—è: $(python3 --version 2>/dev/null || echo 'Python –Ω–µ –Ω–∞–π–¥–µ–Ω')"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å YouTube
echo "üåê –ü—Ä–æ–≤–µ—Ä—è—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å YouTube..."
if ping -c 1 youtube.com &> /dev/null; then
    echo "‚úÖ YouTube –¥–æ—Å—Ç—É–ø–µ–Ω"
else
    echo "‚ùå YouTube –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫
echo "üìÅ –ü—Ä–æ–≤–µ—Ä—è—é –ø–∞–ø–∫—É –∑–∞–≥—Ä—É–∑–æ–∫..."
if [ -d "./downloads" ]; then
    echo "‚úÖ –ü–∞–ø–∫–∞ downloads —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    echo "üìù –ü—Ä–∞–≤–∞: $(ls -ld ./downloads)"
else
    echo "‚ùå –ü–∞–ø–∫–∞ downloads –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
    echo "üî® –°–æ–∑–¥–∞—é –ø–∞–ø–∫—É downloads..."
    mkdir -p ./downloads
    echo "‚úÖ –ü–∞–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∞"
fi

echo ""
echo "üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "================"
echo "1. –ï—Å–ª–∏ yt-dlp —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞"
echo "2. –ï—Å–ª–∏ yt-dlp –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –æ–±–Ω–æ–≤–∏—Ç–µ –µ–≥–æ: pip install --upgrade yt-dlp"
echo "3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–µ–æ –ø—É–±–ª–∏—á–Ω–æ–µ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ"

