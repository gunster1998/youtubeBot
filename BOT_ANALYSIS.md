# üîç **–ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞**

## ‚úÖ **–ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏ –ª–æ–≥–∏–∫–∏**

### üéØ **1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–∏–¥–µ–æ —Å—Å—ã–ª–æ–∫:**

#### **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
- ‚úÖ **YouTube:** `youtube.com/watch?v=`, `youtu.be/`
- ‚úÖ **YouTube Shorts:** `youtube.com/shorts/`
- ‚úÖ **TikTok, Instagram, VK, Twitter, Facebook:** —á–µ—Ä–µ–∑ `universalService`

#### **–í—ã–±–æ—Ä —Å–µ—Ä–≤–∏—Å–∞:**
```go
if platformInfo.Type == services.PlatformYouTube || platformInfo.Type == services.PlatformYouTubeShorts {
    formats, err = bot.youtubeService.GetVideoFormats(message.Text)
} else {
    formats, err = bot.universalService.GetVideoFormats(message.Text)
}
```

### üé¨ **2. –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤:**

#### **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤:**
1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤** –æ—Ç `yt-dlp`
2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏** —Å Telegram (MP4, MOV, –∞—É–¥–∏–æ)
3. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é** (256x144, 426x240, 640x360, etc.)
4. **–í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è

#### **–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:**
```go
// 1. –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞–∑–º–µ—Ä—É —Ñ–∞–π–ª–∞ (–æ—Ç –º–µ–Ω—å—à–µ–≥–æ –∫ –±–æ–ª—å—à–µ–º—É)
sort.Slice(formats, func(i, j int) bool {
    sizeI := parseFileSize(formats[i].FileSize)
    sizeJ := parseFileSize(formats[j].FileSize)
    return sizeI < sizeJ
})

// 2. –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º —Ñ–æ—Ä–º–∞—Ç —Å –∞—É–¥–∏–æ
for _, f := range formats {
    if f.HasAudio {
        bestFormat = &f
        break
    }
}

// 3. –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ —Å –∞—É–¥–∏–æ, –±–µ—Ä–µ–º —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π
if bestFormat == nil {
    bestFormat = &formats[0]
}
```

### üéµ **3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ –∏ –≤–∏–¥–µ–æ:**

#### **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤:**
- **–ê—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç—ã:** `Extension == "audio"` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å –∏–∫–æ–Ω–∫–æ–π üéµ
- **–í–∏–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç—ã:** –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å –∏–∫–æ–Ω–∫–æ–π üé•

#### **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–≤—É–∫–∞:**
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞–º —Å –∞—É–¥–∏–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- ‚úÖ **Fallback –Ω–∞ —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π** –µ—Å–ª–∏ –Ω–µ—Ç –∞—É–¥–∏–æ
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏** –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### üì± **4. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

#### **–ù–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
- ‚úÖ **–£–±—Ä–∞–Ω–æ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –º–µ–Ω—é** –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ **–°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã** (–∞—É–¥–∏–æ + –≤–∏–¥–µ–æ)
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç:** "–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤"
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏:** üéµ –¥–ª—è –∞—É–¥–∏–æ, üé• –¥–ª—è –≤–∏–¥–µ–æ

#### **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤:**
```go
buttonText := fmt.Sprintf("%s %s / %s", icon, format.Resolution, format.FileSize)
// –ü—Ä–∏–º–µ—Ä—ã:
// üéµ audio / 6.34MiB
// üé• 1280x720 / 12.18MiB
// üé• 1920x1080 / 4.15MiB
```

### üíæ **5. –°–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**

#### **–ö—ç—à –ø–æ –∫–ª—é—á—É (videoID, platform, formatID):**
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞:** `videoID_formatID.ext`
- ‚úÖ **–ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ** –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

#### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞:**
```go
if isCached, cachedVideo, err := bot.cacheService.IsVideoCached(videoID, platform, formatID); 
   err == nil && isCached {
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑ –∫—ç—à–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
}
```

### üöÄ **6. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ:**

#### **–í—ã–±–æ—Ä —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:**
```go
if platform == "youtube" || platform == "youtube_shorts" {
    videoPath, err = bot.youtubeService.DownloadVideoWithFormat(videoURL, formatID)
} else {
    videoPath, err = bot.universalService.DownloadVideoWithFormat(videoURL, formatID)
}
```

#### **–§–æ—Ä–º–∞—Ç –∫–æ–º–∞–Ω–¥—ã yt-dlp:**
```bash
yt-dlp --format formatID+bestaudio/best \
       --output downloads/%(id)s_formatID.%(ext)s \
       --merge-output-format mp4 \
       --proxy socks5h://127.0.0.1:10808 \
       URL
```

### üîß **7. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

#### **–î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:**
- ‚úÖ **–ì–µ–æ-–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** "–í–∏–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ –≤–∞—à–µ–º —Ä–µ–≥–∏–æ–Ω–µ"
- ‚úÖ **–ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ:** "–ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –≤–∏–¥–µ–æ"
- ‚úÖ **–¢–∞–π–º–∞—É—Ç:** "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è"
- ‚úÖ **SSL –ø—Ä–æ–±–ª–µ–º—ã:** "–ü—Ä–æ–±–ª–µ–º—ã —Å SSL —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º"
- ‚úÖ **–ö–æ–Ω—Ç–µ–Ω—Ç 18+:** "–í–∏–¥–µ–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö"

## üéØ **–ê–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤:**

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:**

1. **üé¨ YouTube –æ–±—ã—á–Ω—ã–µ –≤–∏–¥–µ–æ:**
   - ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ `youtubeService`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ Telegram —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
   - ‚úÖ –í—ã–±–æ—Ä –ª—É—á—à–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å –∞—É–¥–∏–æ
   - ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏ —Ñ–∞–π–ª–æ–≤
   - ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ `(videoID, platform, formatID)`

2. **üé¨ YouTube Shorts:**
   - ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã `youtube_shorts`
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `youtubeService` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
   - ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ URL `youtube.com/shorts/` –≤ `extractVideoID`
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ `videoID_formatID.ext`

3. **üéµ –ê—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç—ã:**
   - ‚úÖ –û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–∫–æ–Ω–∫–∏ üéµ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
   - ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞–º —Å –∞—É–¥–∏–æ

4. **üé• –í–∏–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç—ã:**
   - ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—é
   - ‚úÖ –í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
   - ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ñ–æ—Ä–º–∞—Ç–∞–º —Å –∞—É–¥–∏–æ
   - ‚úÖ Fallback –Ω–∞ —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –µ—Å–ª–∏ –Ω–µ—Ç –∞—É–¥–∏–æ

### üîç **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

1. **‚ö†Ô∏è –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–∞–∑–º–µ—Ä—É:**
   - –§—É–Ω–∫—Ü–∏—è `parseFileSize` –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–º–µ—Ä—ã
   - –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Ç–∏–ø–∞ "~1.2MiB"

2. **‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram:**
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ 2GB
   - –¢–æ–ª—å–∫–æ MP4, MOV –¥–ª—è –≤–∏–¥–µ–æ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ `isTelegramCompatible`

3. **‚ö†Ô∏è –°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
   - –ü—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å
   - –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö
   - Retry –º–µ—Ö–∞–Ω–∏–∑–º (2 –ø–æ–ø—ã—Ç–∫–∏)

## üöÄ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

### ‚úÖ **–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- **–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- **–ó–≤—É–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–∞ –≤–∏–¥–µ–æ —Ñ–æ—Ä–º–∞—Ç–∞—Ö
- **YouTube Shorts —Ä–∞–±–æ—Ç–∞—é—Ç** –±–µ–∑ –æ—à–∏–±–æ–∫
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ª—É—á—à–µ–Ω** –∏ –ø–æ–Ω—è—Ç–µ–Ω

### üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –æ—à–∏–±–æ–∫
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–∏–ø—ã –≤–∏–¥–µ–æ
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ retry –ø–æ–ø—ã—Ç–æ–∫
4. **–ö—ç—à** - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã

**–ú–∞–º–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!** üíö –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

